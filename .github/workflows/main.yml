name: Test create env

on:
#  push:
  workflow_dispatch:  # Allow manual triggering of the workflow

jobs: 
  create_env_file_job:
    runs-on: ubuntu-latest
    steps:
      #- name: Create .env file
      #  uses: ozaytsev86/create-env-file@v1
      #  with:
      #    ENV_TEST_API_KEY: ${{ secrets.TEST_API_KEY }}
      #    ENV_ANOTHER_KEY: ${{ secrets.ANOTHER_KEY }}
      - name: Run your script
        run: |
          GITHUB_COMMIT=${{ github.ref }}
          echo $GITHUB_COMMIT
          GITHUB_SHA_SHORT=$(echo $GITHUB_SHA | cut -c1-7)
          echo $GITHUB_SHA_SHORT
          echo $GITHUB_SHA_SHORT >> $GITHUB_ENV

      - name: executing remote ssh commands using password
        uses: appleboy/ssh-action@master
        #env: 
        #  GITHUB_SHA_SHORT: $GITHUB_SHA_SHORT
        with:
          host: ${{ secrets.PROD_IP }}
          username: root
          key: ${{ secrets.PROD_SERVER_KEY }}
          envs: GITHUB_SHA_SHORT
          script: |
            export GITHUB_SHA_SHORT=$GITHUB_SHA_SHORT
            echo "Github commit: $GITHUB_SHA_SHORT"
            echo $GITHUB_SHA_SHORT
            DIR=${WEB_DIR}/${GITHUB_SHA_SHORT}-`date -Isec`
            echo $DIR
          
